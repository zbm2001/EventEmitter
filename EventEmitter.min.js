/*
 * @name: EventEmitter
 * @version: 1.0.0
 * @description: javascript Date Object extend
 * @author: zbm2001@aliyun.com
 * @license: Apache 2.0
 */
define(function(){"use strict";function e(e){return h.call(e).slice(8,-1)}function t(t){return"Function"===e(t)&&p===(t+="").slice(t.indexOf("{"))}function n(){}function i(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function r(){}function s(){return!0}function o(){return!1}function a(e,t){var n=e.length;if(t)switch(typeof t){case"function":for(;n--;)if(e[n].handleEvent===t)return n;return-1;case"object":for(;n--;)if(e[n].listener===t)return n;return-1}return-1}function l(e,t){var n,i=0,r=e.length,s=[];e:for(;++i<r;)if(n=e[i])switch(typeof n){case"function":var o;s.push((o={listener:null,handleEvent:n,limit:"number"==typeof t?t:1/0},o[d]=++b,o));continue e;case"object":var a;s.push(n[d]?n:(a={listener:n,handleEvent:null,limit:"number"==typeof t?t:1/0},a[d]=++b,a));continue e}return s}function c(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return(i=this)[e].apply(i,t);var i}}function f(e,t,n){return Object.assign(e.prototype=Object.create(this.prototype),{constructor:e},t),Object.assign(e,n)}var h=Object.prototype.toString,u=Array.prototype.pop+"",p=u.slice(u.indexOf("{"));t(Object.assign)?Object.assign:Object.assign=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i,r,s=Object(e),o=-1,a=t.length;++o<a;)if(r=t[o],null!=r)for(i in r)r.hasOwnProperty(i)&&(s[i]=r[i]);return s};var v={object:!0,function:!0};t(Object.create)?Object.create:Object.create=function(e,t){if(null==e||!v[typeof e])throw"Object prototype may only be an Object or null";n.prototype=e;var i,r,s=new n,o=Object.prototype.hasOwnProperty;if(t){if(!v[typeof t])throw"Property description must be an object: value";for(r in t)if(o.call(t,r)){if(!(i=t[r])||!v[typeof i])throw"Property description must be an object: value";e[r]=i.value}}return s},Object.assign(r.prototype,{type:"",CAPTURING_PHASE:1,AT_TARGET:2,BUBBLING_PHASE:3,eventPhase:0,currentTarget:null,target:null,bubbles:!0,cancelBubble:!1,cancelable:!0,returnValue:!0,initEvent:function(e,t,n){return this.type=e,this.bubbles=!!t,this.cancelable=!!n,this.bubbles||(this.stopPropagation=o),this.cancelable||(this.preventDefault=o),this},preventDefault:function(){this.preventDefault=this.isDefaultPrevented=s,this.returnValue=!1},isDefaultPrevented:o,stopPropagation:function(){this.stopPropagation=this.isPropagationStopped=s,this.cancelBubble=!0},isPropagationStopped:o,stopImmediatePropagation:function(){this.returnValue=!1,this.stopPropagation(),this.stopImmediatePropagation=this.isImmediatePropagationStopped=s},isImmediatePropagationStopped:o}),Object.assign(r,{CAPTURING_PHASE:1,AT_TARGET:2,BUBBLING_PHASE:3,returnTrue:s,returnFalse:o});var d="__event_listener_wrapper_"+Date.now()+"_"+i()+"__",b=0;return Object.assign(EventEmitter.prototype,{_events:null,eventTypeDelimiter:/\s+/,addListener:function(e){function t(){for(var e=-1;++e<u;)a(s,h[e].listener||h[e].handleEvent)<0&&s.push(h[e])}for(var n=[],i=arguments.length-1;i-- >0;)n[i]=arguments[i+1];var r,s,o,c,f,h,u=n.length;if(!e||!u)return this;switch(r=this._events,h=l(n),typeof e){case"string":if("*"===e){if(r)for(c in r)s=r[c],t()}else if(o=e.split(this.eventTypeDelimiter),f=o.length,r)for(;f--;)r.hasOwnProperty(o[f])?(s=r[o[f]],t()):r[o[f]]=h.slice();else for(r=this._events={};f--;)r[o[f]]=h.slice();break;default:if("function"==typeof e.test&&r)for(c in r)e.test(c)&&(s=r[c],t())}return h.emittingIndex=-1,this},on:c("addListener"),addOnceListener:function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];for(var i,r=l(t),s=-1;i=r[++s];)i.limit=1;return(o=this).addListener.apply(o,[e].concat(r));var o},once:c("addOnceListener"),removeListener:function(e){function t(e,t,n){var i=n.length,r=0,s=e[t];if(i){do if((index=a(s,n[r]))>-1){if(s.splice(index,1),!s.length)return void delete e[t];s.emittingIndex<index||s.emittingIndex--}while(++r<i)}else s.length=0,delete e[t]}for(var n=this,i=[],r=arguments.length-1;r-- >0;)i[r]=arguments[r+1];var s,o,l,c=this._events;if(!e||!c)return this;switch(typeof e){case"string":if("*"===e)for(l in c)t(c,l,i);else for(s=e.split(this.eventTypeDelimiter),o=s.length;--o>-1;)l=s[o],c[l]&&t(c,l,i);break;default:if("function"==typeof e.test)for(l in c)e.test(l)&&t(c,l,i)}for(l in c)return n;return delete this._events,this},off:c("removeListener"),addAllListeners:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return(n=this).addListener.apply(n,["*"].concat(e));var n},onAll:c("addAllListeners"),removeAllListeners:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return(n=this).removeListener.apply(n,["*"].concat(e));var n},offAll:c("removeAllListeners"),emitEvent:function(e,t,n,i,r,s){function o(e,t,o){var a,l,c,f,u=this;t.emittingIndex=-1,h=this.createEvent(e,n),s||h.preventDefault();e:for(;a=t[++t.emittingIndex];){switch(c=a.listener||u,l=a.handleEvent||c.handleEvent,o.length){case 0:f=l.call(c,h);break;case 1:f=l.call(c,h,o[0]);break;case 2:f=l.call(c,h,o[0],o[1]);break;case 3:f=l.call(c,h,o[0],o[1],o[2]);break;default:f=l.apply(c,[h].concat(o))}switch(f){case!1:break e;case!0:u.removeListener(e,a)}}t.emittingIndex=-1,this.parent&&this.parent.emitEvent&&!h.isPropagationStopped()&&this.parent.emitEvent(e,o,n,i,r,h.returnValue)}var a,l,c,f,h,u=this,p=this._events;if(!e)return h;if(n||(n=this),t||(t=[]),p)switch(typeof e){case"string":if("*"===e)for(f in p)o.call(u,f,p[f],t);else for(c=e.split(this.eventTypeDelimiter),l=c.length,a=-1;++a<l;)o.call(u,c[a],p[c[a]],t);break;default:if("function"==typeof e.test)for(f in p)e.test(f)&&o.call(u,f,p[f],t)}else this.parent&&this.parent.emitEvent&&this.parent.emitEvent(e,t,n,i,r,s);return h},createEvent:function(e,t,n,i){var s=new r;return s.currentTarget=this,s.target=t||this,s.timeStamp=now(),s.initEvent(e,canBubble,i),EventEmitter.event=s},emit:function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return this.emitEvent(e,t,this,!0,!0,!0)},trigger:c("emit"),_getEvents:function(){return this._events||(this._events={})},getListeners:function(e){var t,n=this._events,i=[];if(!n){if("function"==typeof e.test){response={};for(t in n)n.hasOwnProperty(t)&&e.test(t)&&(response[t]=n[t])}else response=n[e]||(n[e]=[]);return i}},bindHandleEvent:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return(n=this).bind.apply(n,["handleEvent"].concat(e)),this.bindHandleEvent=this.bind,this;var n},bind:function(){for(var e=this,t=[],n=arguments.length;n--;)t[n]=arguments[n];for(var i,r=-1,s=t.length;++r<s;)i=t[r],"function"==typeof e[i]&&!e.hasOwnProperty(i)&&(e[i]=e[i].bind(e))},parent:null,children:null,appendChild:function(e){if(!(e instanceof EventEmitter))throw new TypeError(e+"is not instanceof EventEmitter.");if(this.isAncestor(e,!0))throw new Error("The new child instance contains this instance.");return this.children||(this.children=[]),this.children.indexOf(e)<0&&(e.parent&&e.parent.removeChild(e),this.children.push(e),e.parent=this),e},removeChild:function(e){if(!(e instanceof EventEmitter))throw new TypeError(e+"is not instanceof EventEmitter.");var t;if(!(this.children&&(t=this.children.indexOf(e))>-1))throw new Error("The instance to be removed is not a child of this instance.");return this.children.splice(t,1),delete e.parent,e},isAncestor:function(e,t){var n=t?this:this.parent;do if(e===n)return!0;while(n=n.parent);return!1}}),Object.assign(EventEmitter,{inherito:f,Event:r}),EventEmitter});