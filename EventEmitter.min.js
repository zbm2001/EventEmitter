/*
 * @name: EventEmitter
 * @version: 1.0.0
 * @description: javascript Date Object extend
 * @author: zbm2001@aliyun.com
 * @license: Apache 2.0
 */
define(function(){"use strict";function t(t){return f.call(t).slice(8,-1)}function e(e){return"Function"===t(e)&&u===(e+="").slice(e.indexOf("{"))}function n(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function i(){}function r(){return!0}function o(){return!1}function a(t,e){var n=t.length;if(e)switch(typeof e){case"function":for(;n--;)if(t[n].handleEvent===e)return n;return-1;case"object":for(;n--;)if(t[n].listener===e)return n;return-1}return-1}function s(t,e){var n,i=0,r=t.length,o=[];"number"!=typeof e&&(e=1/0);t:for(;++i<r;)if(n=t[i])switch(typeof n){case"function":var a;o.push((a={listener:null,handleEvent:n,limit:e},a[v]=++d,a));continue t;case"object":var s;o.push(n[v]?n:(s={listener:n,handleEvent:null,limit:e},s[v]=++d,s));continue t}return o}function l(t){return function(){return this[t].apply(this,arguments)}}function c(t,e,n){return Object.assign(t.prototype=Object.create(this.prototype),{constructor:t},e),Object.assign(t,n)}var f=Object.prototype.toString,u=function(t){return t.slice(t.indexOf("{"))}(Array.prototype.pop+"");if(e(Object.assign)||(Object.assign=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i,r,o=Object(t),a=-1,s=e.length;++a<s;)if(r=e[a],null!=r)for(i in r)r.hasOwnProperty(i)&&(o[i]=r[i]);return o}),!e(Object.create)){var h=Object.prototype.hasOwnProperty,p={object:!0,function:!0};Object.create=function(t,e){if(null==t||!p[typeof t])throw"Object prototype may only be an Object or null";var n,i,r={__proto__:t};if(e){if(!p[typeof e])throw"Property description must be an object: value";for(i in e)if(h.call(e,i)){if(!(n=e[i])||!p[typeof n])throw"Property description must be an object: value";t[i]=n.value}}return r}}Object.assign(i.prototype,{type:"",CAPTURING_PHASE:1,AT_TARGET:2,BUBBLING_PHASE:3,eventPhase:0,currentTarget:null,target:null,bubbles:!0,cancelBubble:!1,cancelable:!0,returnValue:!0,initEvent:function(t,e,n,i,a){return this.type=t,this.currentTarget=e,this.target=n||e,this.timeStamp=Date.now(),this.bubbles=!!i,this.cancelable=!!a,this.bubbles||(this.cancelBubble=!0,this.stopPropagation=o,this.isPropagationStopped=r),this.cancelable||(this.preventDefault=o),this},preventDefault:function(){return this.preventDefault=this.isDefaultPrevented=r,this.returnValue=!1,!0},isDefaultPrevented:o,stopPropagation:function(){return this.stopPropagation=this.isPropagationStopped=r,this.cancelBubble=!0,!0},isPropagationStopped:o,stopImmediatePropagation:function(){return this.stopPropagation(),this.stopImmediatePropagation=this.isImmediatePropagationStopped=r,!0},isImmediatePropagationStopped:o}),Object.assign(i,{CAPTURING_PHASE:1,AT_TARGET:2,BUBBLING_PHASE:3,returnTrue:r,returnFalse:o});var v="__listener_wrapper_"+Date.now()+"_"+n()+"__",d=0;return Object.assign(EventEmitter.prototype,{_events:null,eventTypeDelimiter:/\s+/,addListener:function(t){function e(){for(var t=-1;++t<h;)a(o,u[t].listener||u[t].handleEvent)<0&&o.push(u[t])}for(var n=[],i=arguments.length-1;i-- >0;)n[i]=arguments[i+1];var r,o,l,c,f,u,h=n.length;if(!t||!h)return this;switch(r=this._events,u=s(n),typeof t){case"string":if("*"===t){if(r)for(c in r)o=r[c],e()}else if(l=t.split(this.eventTypeDelimiter),f=l.length,r)for(;f--;)r.hasOwnProperty(l[f])?(o=r[l[f]],e()):r[l[f]]=u.slice();else for(r=this._events={};f--;)r[l[f]]=u.slice();break;default:if("function"==typeof t.test&&r)for(c in r)t.test(c)&&(o=r[c],e())}return u.emittingIndex=-1,this},on:l("addListener"),addOnceListener:function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var i=s(e,1);return(r=this).addListener.apply(r,[t].concat(i));var r},once:l("addOnceListener"),addOnlimitListener:function(t,e){for(var n=[],i=arguments.length-2;i-- >0;)n[i]=arguments[i+2];var r=s(n,e);return(o=this).addListener.apply(o,[t].concat(r));var o},onlimit:l("addOnlimitListener"),removeListener:function(t){function e(t,e,n){var i=n.length,r=0,o=t[e];if(i){do if((index=a(o,n[r]))>-1){if(o.splice(index,1),!o.length)return void delete t[e];o.emittingIndex<index||o.emittingIndex--}while(++r<i)}else o.length=0,delete t[e]}for(var n=this,i=[],r=arguments.length-1;r-- >0;)i[r]=arguments[r+1];var o,s,l,c=this._events;if(!t||!c)return this;switch(typeof t){case"string":if("*"===t)for(l in c)e(c,l,i);else for(o=t.split(this.eventTypeDelimiter),s=o.length;--s>-1;)l=o[s],c[l]&&e(c,l,i);break;default:if("function"==typeof t.test)for(l in c)t.test(l)&&e(c,l,i)}for(l in c)return n;return delete this._events,this},off:l("removeListener"),addAllListeners:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return(n=this).addListener.apply(n,["*"].concat(t));var n},onAll:l("addAllListeners"),removeAllListeners:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return(n=this).removeListener.apply(n,["*"].concat(t));var n},offAll:l("removeAllListeners"),emitEvent:function(t,e,n,i,r,o){function a(t,e,a){var s,l,c,f,u=this;e.emittingIndex=-1,p=this.createEvent(t,a,n,i,r,o);t:for(;s=e[++e.emittingIndex];){switch(c=s.listener||u,l=s.handleEvent||c.handleEvent,a.length){case 0:f=l.call(c,p);break;case 1:f=l.call(c,p,a[0]);break;case 2:f=l.call(c,p,a[0],a[1]);break;case 3:f=l.call(c,p,a[0],a[1],a[2]);break;default:f=l.apply(c,[p].concat(a))}switch(f){case!1:break t;case!0:u.removeListener(t,s);break;default:--s.limit||u.removeListener(t,s)}if(p.isImmediatePropagationStopped())break}e.emittingIndex=-1}var s,l,c,f,u=this,h=this._events,p=null;if(!t)return p;if(n||(n=this),e||(e=[]),h){switch(typeof t){case"string":if("*"===t)for(f in h)a.call(u,f,h[f],e),u.emitEventPropagation(p);else{if(c=t.split(this.eventTypeDelimiter),l=c.length,l<2){a.call(this,t,h[t],e);break}for(s=-1;++s<l;)a.call(u,c[s],h[c[s]],e),u.emitEventPropagation(p)}break;default:if("function"==typeof t.test)for(f in h)t.test(f)&&(a.call(u,f,h[f],e),u.emitEventPropagation(p))}delete EventEmitter.event}else this.parent&&this.parent.emitEvent&&this.parent.emitEvent(t,e,n,i,r,o);return p},emitEventPropagation:function(t){this.parent&&this.parent.emitEvent&&!t.isPropagationStopped()&&this.parent.emitEvent(t.type,t.emitArgs,t.target,t.bubbles,t.cancelable,t.returnValue)},createEvent:function(t,e,n,r,o,a){var s=new i;return s.initEvent(t,this,e,n,r),s.emitArgs=o,a||s.preventDefault(),EventEmitter.event=s},emit:function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return this.emitEvent(t,e,this,!0,!0,!0)},bindHandleEvent:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return(n=this).bind.apply(n,["handleEvent"].concat(t)),this;var n},bind:function(){for(var t=this,e=[],n=arguments.length;n--;)e[n]=arguments[n];for(var i,r=-1,o=e.length;++r<o;)i=e[r],"function"==typeof t[i]&&!t.hasOwnProperty(i)&&(t[i]=t[i].bind(t))},parent:null,children:null,appendChild:function(t){if(!(t instanceof EventEmitter))throw new TypeError(t+"is not instanceof EventEmitter.");if(this.isAncestor(t,!0))throw new Error("The new child instance contains this instance.");return this.children||(this.children=[]),this.children.indexOf(t)<0&&(t.parent&&t.parent.removeChild(t),this.children.push(t),t.parent=this),t},removeChild:function(t){if(!(t instanceof EventEmitter))throw new TypeError(t+"is not instanceof EventEmitter.");var e;if(!(this.children&&(e=this.children.indexOf(t))>-1))throw new Error("The instance to be removed is not a child of this instance.");return this.children.splice(e,1),delete t.parent,t},isAncestor:function(t,e){var n=e?this:this.parent;do if(t===n)return!0;while(n=n.parent);return!1}}),Object.assign(EventEmitter,{event:null,inherito:c,Event:i}),EventEmitter});